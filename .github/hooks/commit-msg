#!/bin/sh

# git config core.hooksPath .githooks

shopt -s nocasematch
msg_file=$1
msg=$(cat "$msg_file")

declare -A regex_sections=(
  ["âœ¨"]="^[ ]*(âœ¨|æ–°å¢ž|feat)(\\(.+\\))?([ ]|[:ï¼š][ ]?)"
  ["ðŸ©¹"]="^[ ]*(ðŸ©¹|ä¿®å¤|fix)(\\(.+\\))?([ ]|[:ï¼š][ ]?)"
  ["ðŸ“š"]="^[ ]*(ðŸ“š|æ–‡æ¡£|docs)(\\(.+\\))?([ ]|[:ï¼š][ ]?)"
  ["ðŸŽ¨"]="^[ ]*(ðŸŽ¨|é£Žæ ¼|style)(\\(.+\\))?([ ]|[:ï¼š][ ]?)"
  ["ðŸš€"]="^[ ]*(ðŸš€|æ€§èƒ½|perf)(\\(.+\\))?([ ]|[:ï¼š][ ]?)"
  ["ðŸ§©"]="^[ ]*(ðŸ§©|é…ç½®|config)(\\(.+\\))?([ ]|[:ï¼š][ ]?)"
  ["ðŸŒ"]="^[ ]*(ðŸŒ|è¯­è¨€|i18n)(\\(.+\\))?([ ]|[:ï¼š][ ]?)"
  ["ðŸ€"]="^[ ]*(ðŸ€|æ‚é¡¹|chore)(\\(.+\\))?([ ]|[:ï¼š][ ]?)"
)

for category in "${!regex_sections[@]}"; do
  regex=${regex_sections[$category]}
  if [[ $msg =~ $regex ]]; then
    # åˆ é™¤åŒ¹é…åˆ°çš„å‰ç¼€ï¼ˆemoji/ç±»åž‹ï¼‰
    clean_msg=$(echo "$msg" | sed -E "s/$regex//I")
    # åŽ»æŽ‰å¼€å¤´å’Œç»“å°¾æ‰€æœ‰ç©ºæ ¼
    clean_msg=$(echo "$clean_msg" | sed -E 's/[ ]+/ /g; s/^[ ]+//; s/[ ]+$//')
    # å¼ºåˆ¶ç»Ÿä¸€æ ¼å¼ï¼šemoji + ä¸€ä¸ªç©ºæ ¼ + æè¿°
    if [[ $clean_msg == $category* ]]; then
      echo "$clean_msg" > "$msg_file"
    else
      echo "$category $clean_msg" > "$msg_file"
    fi
    exit 0
  fi
done